global
 daemon
 log stdout local0 info
 maxconn 4096

defaults
 mode http
 log global
 timeout connect 5000ms
 timeout client 50000ms
 timeout server 50000ms
 retries 3

# Stats page
frontend stats
 bind *:8404
 stats enable
 stats uri /stats
 stats refresh 30s

# HTTP interface load balancer
frontend clickhouse_http
 bind *:8123
 option httplog
 option forwardfor
 default_backend clickhouse_http_servers

backend clickhouse_http_servers
 balance roundrobin
 option httpchk GET /ping
 http-check expect status 200
 server clickhouse01 clickhouse01:8123 check inter 5s rise 2 fall 3
 server clickhouse02 clickhouse02:8123 check inter 5s rise 2 fall 3

# Native TCP interface load balancer
frontend clickhouse_native
 mode tcp
 bind *:9000
 option tcplog
 default_backend clickhouse_native_servers

backend clickhouse_native_servers
 mode tcp
 balance roundrobin
 option tcp-check
 server clickhouse01 clickhouse01:9000 check inter 5s rise 2 fall 3
 server clickhouse02 clickhouse02:9000 check inter 5s rise 2 fall 3
